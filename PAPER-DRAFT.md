# StealthSwap a on-chain Stealh Payments Protocol for Web3 Applications


## Abstract

In this paper we present StealthSwap a decentralized on-chain oracle based stealth payments protocol for Ethereum transactions.
StealthSwap functions using smart contracts only and doesn't require zkSNARks or more complex cryptographic primitives to operate.
Making it both use 80% less fees than other privacy based solutions and easier to audit and verify.

StealthSwap doesn't require sidechains or any constraints on token amounts and time, using StealthSwap you can send
and receive Ether and any ERC20 token without anyone's knowledge.


## The Ethereum Protocol and Smart Contracts

Ethereum is an open blockchain platform that lets anyone build and use decentralized applications that run on blockchain technology. Like Bitcoin, no one controls or owns Ethereum â€“ it is an open-source project built by many people around the world. But unlike the Bitcoin protocol, Ethereum was designed to be adaptable and flexible. It is easy to create new applications on the Ethereum platform, and with the Homestead release, it is now safe for anyone to use those applications.

Smart contracts are decentralized tamper-proof applications that live on the blockchain. Their execution and function is triggered
by message calls (transactions). And as applications smart contracts can use external calls to execute other smart contracts.

Because of their autonomy smart-contracts offer an alternative to more centralized and trusted applications. Making them a trustless alternatuve to other applications.

Smart contracts can operate as oracles by publishing events but also as automated entity able to receive and send tokens without
any risks. These properties are what makes smart contracts an attractive alternative to centralized solutions especially since
the blockchain represents a tamper-proof platform for insuring and verifying the publication of data.

## Privacy

One example of privacy is anonymity, or privacy of identity. In the context of public blockchains, 
anonymity refers to the ability for parties to exchange something (i.e. money, tokens, or data) 
without needing to reveal identity-related information about themselves or other transactions they have done. 
While this is only one facet of privacy, it has become increasingly important as blockchain has evolved.

Cryptocurrencies like bitcoin and ether have been increasingly traced to correlate public addresses across transactions and to analyze and link to off-chain identities on crypto to fiat conversions. The net effect of this makes the identities of parties in transactions more public. Because public blockchains must fundamentally provide a log of all transactions, privacy for consumers and enterprises using cryptographic algorithms and protocols has become increasingly relevant.

Enterprises and consumers have very different demands when it comes to privacy. Enterprises typically require privacy in the form of transaction data, for example, product name, quantity, price, address, personally identifiable financial information, etc.

The lack of privacy on Ethereum represents a large issue since accounts are more easier to trace and track than UTXOs.

The current only active privacy option available is severly limited due to the high fees required to verify snark proofs and
are not suitable for the case of token transfers.

Mixers work are a technology based on scrambling transactions together. 
But Mixers only work with transactions happening at that moment by using a set of fake transactions (called "Mix-ins") plus 
several real transactions all which sum to approximated the same number of units of ETH. 
Basically, when you send a transaction for 5 units of ETH, you need to wait for 1 or 2 other people to also send 5 ETH so that you can scramble all 3 transactions together.
Mixers send the outputs to a bunch of addresses with smaller amounts which sum to your original units. 
This way it can be very confusing to line up who sent what to where when you are actively trying to make transactions look similar. 
The system works better the more people who are using it at that moment.

## Stealth Address Protocol


![stealth](https://i.imgur.com/FI0u218.png)

Stealth Addresses are based on randomness (generated by users and is cryptographically random) and the ECDH protocol.
Elliptic Curve Diffie Hellman is a cryptographic protocol used to generate a shared secret between users.

Stealth addresses enables the sender and receiver to non-interactively generate a shared secret. 
By generating a shared secret key (and thereby a shared public key), and then publishing the shared public key on-chain, the link between sender and receiver is temporarily anonymized.

The stealth address created using the generated random data is used to receive funds, the random data is encrypted by the sender
and published on-chain.

In order to publish data on-chain a special contract called *Master* operates as oracle, it is responsible for announcing new events.

When a party scans the messages broadcasted or queried by *Master* he can find the **encrypted message** he can decrypt with
his own key. 

Once decrypted users can create the private key of the *stealth address* and withdraw coins from the *stealth address* to another
account they own. Without establishing any publicly known link.

Optionally, the withdrawal transaction is broadcast via [Gas Station Network](https://www.opengsn.org/) transaction relayers, obviating the need to fund the stealth address to access tokens. The StealthSwap contracts swap some of the tokens via Uniswap to pay the GSN relayer for gas.

No funds are held by StealthSwap protocol at any time.

## The OWL Token

The OWL Token is StealthSwap own ecosystem token, it's used to pay for transation fees, yield and staking rewards and encouraging
user adoption of the protocol.

Since *stealth addresses* are unfunded to send the funds to another address users need to pay for Gas fees, in order to avoid
tarnishing the addresses users can use the OWL token to pay for the transaction fees using the GSN.

Making it effectively the first and only fully privacy-preserving on-chain payment protocol on Ethreum.

## Conclusion

In this paper we presented the StealthSwap protocol and the backing infrastructure used to deliver privacy preserving payments
to Ethereum users.

As usage of the blockchain rises users will naturally tend to seek solutions to hide and make their transactions private.
StealthSwap is thus here to offer a highly efficient, user friendly privacy preserving solution to solve this issue.
